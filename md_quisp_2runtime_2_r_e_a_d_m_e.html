<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QuISP: Runtime</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">QuISP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_quisp_2runtime_2_r_e_a_d_m_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Runtime</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md55"></a></p>
<p>The Runtime is an environment for executing RuleSet. This Runtime abstraction allows us to analyze the behavior of RuleSet execution for further research about RuleSet-based quantum networks. The Runtime is a simple register-based machine with a simple key-value memory store. It's responsible for executing RuleSet written in intermediate representations(IR) and managing its states like assigned qubits entangled with a partner, temporary values (Registers and Memory), and flags. The current Runtime design focuses on 1). easy to implement and debug, 2). flexible in tweaking the instructions. See also <a class="el" href="namespacequisp_1_1runtime.html">quisp::runtime</a></p>
<h1><a class="anchor" id="autotoc_md56"></a>
Intermediate Representations (IR)</h1>
<p>The IR is similar to the Intel syntax so that we can write down the instruction: "load the value of the _KEY_ from the memory to the register _REG0_" into "LOAD REG0 KEY". Be careful about the order of the destination (<em>REG0</em>) and the source (<em>KEY</em>). The IR is like a simple assembly language with labels. Action and Condition in a Rule are written in the IR to describe how it works. We can write a control flow with jump or branch instructions. So there is no if-else statement nor for-loop syntax in the language due to simplicity for implementation and debugging. Here is an pseudo code to perform the random measure action and its C++ representations.</p>
<div class="fragment"><div class="line">  // load the &quot;count&quot; key from memory to the register</div>
<div class="line">  LOAD count &quot;count&quot;</div>
<div class="line"> </div>
<div class="line">  // get the n-th resource qubit pointer that is entangled with partner_addr </div>
<div class="line">  // into q0. the qubits are ordered by allocation to the current Rule.</div>
<div class="line">  // if qubit is not found, set qubit_found flag false.</div>
<div class="line">  GET_QUBIT q0 partner_addr qubit_resource_index</div>
<div class="line"> </div>
<div class="line">  // if qubit_found flag is set true, go to QUBIT_FOUND label</div>
<div class="line">  BRANCH_IF_QUBIT_FOUND QUBIT_FOUND</div>
<div class="line"> </div>
<div class="line">  // raise unrecoverable error and stop execution</div>
<div class="line">  RET ReturnCode::ERROR</div>
<div class="line"> </div>
<div class="line">QUBIT_FOUND: // this is a label</div>
<div class="line"> </div>
<div class="line">  // measure the qubit q0 and store the result to the &quot;outcome&quot; key</div>
<div class="line">  MEASURE_RANDOM &quot;outcome&quot; q0</div>
<div class="line"> </div>
<div class="line">  // increment the count register</div>
<div class="line">  INC count</div>
<div class="line"> </div>
<div class="line">  // store the count register val to the &quot;count&quot; key in the memory</div>
<div class="line">  STORE &quot;count&quot; count</div>
<div class="line"> </div>
<div class="line">  // free the qubit q0 from the RuleSet and remove the name q0 from the qubit.</div>
<div class="line">  FREE_QUBIT q0</div>
<div class="line"> </div>
<div class="line">  // send the link tomography (measurement) result to partner_addr.</div>
<div class="line">  SEND_LINK_TOMOGRAPHY_RESULT partner_addr count &quot;outcome&quot; max_count</div>
</div><!-- fragment --><p>The C++ representation format is <code>INSTR_{instruction name}_{argument1 type}_{argument2 type}_</code>. These are aliases of the Instruction template class so that you can instantiate by the C++ initializers list with curly braces like <code>INSTR_ADD_RegId_RegId_int_{{REG0, REG1, 7}}</code>.</p>
<div class="fragment"><div class="line">  <span class="comment">// prepare a qubit id to handle a qubit.</span></div>
<div class="line">  QubitId q0{0};</div>
<div class="line">  <span class="comment">// name the register 0 as count</span></div>
<div class="line">  <span class="keyword">auto</span> count = RegId::REG0;</div>
<div class="line">  <span class="keywordtype">int</span> max_count = 1000;</div>
<div class="line">  QNodeAddr partner_addr{3};</div>
<div class="line">  <span class="keyword">auto</span> qubit_resource_index = 0;</div>
<div class="line">  simtime_t start_time = simTime();</div>
<div class="line">  Label qubit_found_label{<span class="stringliteral">&quot;qubit_found&quot;</span>};</div>
<div class="line">  MemoryKey count_key{<span class="stringliteral">&quot;count&quot;</span>};</div>
<div class="line">  MemoryKey outcome_key{<span class="stringliteral">&quot;outcome&quot;</span>};</div>
<div class="line">  <span class="keywordflow">return</span> Program{</div>
<div class="line">      <span class="stringliteral">&quot;Tomography&quot;</span>,</div>
<div class="line">      {</div>
<div class="line">          <span class="comment">// clang-format off</span></div>
<div class="line">INSTR_LOAD_RegId_MemoryKey_{{count, count_key}},</div>
<div class="line">INSTR_GET_QUBIT_QubitId_QNodeAddr_int_{{q0, partner_addr, qubit_resource_index}},</div>
<div class="line">INSTR_BRANCH_IF_QUBIT_FOUND_Label_{qubit_found_label},</div>
<div class="line">INSTR_RET_ReturnCode_{{ReturnCode::ERROR}},</div>
<div class="line">INSTR_MEASURE_RANDOM_MemoryKey_QubitId_{{outcome_key, q0}, qubit_found_label},</div>
<div class="line">INSTR_INC_RegId_{count},</div>
<div class="line">INSTR_STORE_MemoryKey_RegId_{{count_key, count}},</div>
<div class="line">INSTR_FREE_QUBIT_QubitId_{q0},</div>
<div class="line">INSTR_SEND_LINK_TOMOGRAPHY_RESULT_QNodeAddr_RegId_MemoryKey_int_Time_{{partner_addr, count, outcome_key, max_count, start_time }}</div>
<div class="line">          <span class="comment">// clang-format on</span></div>
<div class="line">      },</div>
<div class="line">  };</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md57"></a>
RuleSet Execution with Runtime</h1>
<p> 
<div class="mermaid">
   sequenceDiagram
        participant RE as RuleEngine
        participant RT as Runtime
        participant IV as InstructionVisitor
        participant CB as ICallBack

        RE->>RT: create Runtime and assign RuleSet
        RT->>IV: initialize
        RT->> CB: initialize
        RT->>RT: analyze the given RuleSet
        RE->>RT: assign qubit
        RE->>+RT: execute RuleSet
        loop Each Program Instruction execution
            RT->>+IV: execute Instruction
            IV->>IV: handle Instruction
            IV->>RT: call Runtime methods
            RT->>CB: call the Callback
            CB->>RE: quantum operation or classical communication
        end
        alt RuleSet not terminated
            RT->>-RE: finish RuleSet execution
        else RuleSet terminated
            RT->>RE: finish RuleSet execution
            RE->>RT: delete the RuleSet and the Runtime
        end
</div>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
</p>
<h1><a class="anchor" id="autotoc_md58"></a>
Storage Scopes</h1>
<p>The Runtime has two types of storage scopes. One is Program-scope, where the Runtime initializes the storage before every Program execution. Only the Program can read/write the storage. Another is RuleSet-scope, where all Rule can read/write their value and the Runtime initializes it only once.</p>
<h1><a class="anchor" id="autotoc_md59"></a>
Storage types</h1>
<p>The Runtime has four types of storage, Register, Memory, Flags, and Qubits.</p>
<h2><a class="anchor" id="autotoc_md60"></a>
Register</h2>
<p>The Register is Program-scope storage that can store one number. You can use these Registers to perform simple arithmetic or check the number of measurements the RuleSet has done or qubits you can use in The Program.</p>
<h2><a class="anchor" id="autotoc_md61"></a>
Memory</h2>
<p>The Memory is RuleSet-scope storage that can store any value with the MemoryKey. Unlike ordinary computer memory, the Memory is a simple key-value store for simplicity and safety. The RuleSet uses this Memory to keep the RuleSet-wise values like the total measurement count. You should load the value to the Register to use the Memory values.</p>
<h2><a class="anchor" id="autotoc_md62"></a>
Flags (pc, should_exit, terminated, error, and return_code)</h2>
<p>The Flag is Program-scope storage that can store a value for control flow. The Program cannot access these values directly.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
Qubits</h2>
<p>The Qubits is RuleSet-scope storage that can store the qubits entangled with other QNode. The RuleEngine assigns the qubits to some Runtime when it detects the entangled qubits. Then the Runtime can use the assigned qubits as their resources to executing the RuleSet. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
